<!DOCTYPE html>
<html>
<head>
<title>Store Dashboard</title>
<style>
* {margin: 0; padding: 0; box-sizing: border-box;}
body {font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; background:#0f172a; color:white; padding:20px; min-height: 100vh;}
.container {max-width: 1200px; margin: 0 auto;}
h1 {text-align:center; margin-bottom:20px; font-size:2em;}
.nav-bar {text-align:right; margin-bottom:20px;}
.nav-bar a {color:#f97316; text-decoration:none; font-weight: 500;}
.nav-bar a:hover {text-decoration: underline;}
.card {background:#1e293b; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow: 0 4px 6px rgba(0,0,0,0.2);}
input, textarea {padding:10px; margin:8px 0; border-radius:6px; border:none; font-family: inherit;}
input {width: calc(33% - 10px); margin-right: 15px;}
input[type="date"] {width: auto;}
button {padding:10px 15px; border:none; border-radius:6px; cursor:pointer; font-weight: 500; transition: all 0.2s;}
.add {background:#22c55e; color:white;}
.add:hover {background:#16a34a;}
.search {background:#3b82f6; color:white;}
.search:hover {background:#2563eb;}
.edit {background:#facc15; color:#000;}
.edit:hover {background:#eab308;}
.delete {background:#ef4444; color:white;}
.delete:hover {background:#dc2626;}
table {width:100%; background:#1e293b; border-collapse:collapse; margin-top:10px; border-radius: 8px; overflow: hidden;}
th, td {padding:12px; border-bottom:1px solid #334155; text-align:center;}
th {background:#2563eb; font-weight: 600;}
tr:hover {background:#334155;}
.summary {display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-bottom:20px;}
.summary div {background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding:20px; border-radius:10px; text-align:center; box-shadow: 0 4px 6px rgba(0,0,0,0.2);}
.summary div strong {font-size: 1.8em; color: #60a5fa;}
.summary div {font-size: 0.9em; color: #cbd5e1;}
.search-form {margin: 20px 0;}
.search-form input {width: calc(100% - 120px); margin-right: 10px;}
a {color: #60a5fa; text-decoration: none;}
a:hover {text-decoration: underline;}
.customer-link {padding: 2px 6px; border-radius: 3px; transition: all 0.2s;}
.customer-link:hover {background: #334155; text-decoration: none;}
.flash-msg {color: #fde68a; background: #7c2d12; padding: 10px; border-radius: 6px; margin-bottom: 15px;}
@media (max-width: 768px) {
  input {width: 100%; margin-right: 0;}
  .summary {grid-template-columns: 1fr;}
  table {font-size: 0.9em;}
  th, td {padding: 8px;}
}
</style>
</head>
<body>

<div class="container">
<h1>Store Manager</h1>

<div class="nav-bar">
  <a href="/analytics">üìä Analytics</a>
  <a href="/products">üì¶ Products</a>
  <a href="/search-advanced">üîç Search</a>
  <a href="/export/csv">üì• Export CSV</a>
  <a href="/logout">Logout</a>
</div>

<div class="summary">
<div>
  <div style="font-size: 0.9em; color: #cbd5e1; margin-bottom: 8px;">Total Sales</div>
  <strong>{{ total_sales|rwf }}</strong>
</div>
<div>
  <div style="font-size: 0.9em; color: #cbd5e1; margin-bottom: 8px;">Total Loans</div>
  <strong>{{ total_loans|rwf }}</strong>
</div>
<div>
  <div style="font-size: 0.9em; color: #cbd5e1; margin-bottom: 8px;">Customers</div>
  <strong>{{ num_customers }}</strong>
</div>
</div>

<div class="card">
<h3 style="margin-bottom: 15px;">Add New Record</h3>
<form method="POST">
<input name="name" placeholder="customer name" required>
<input name="product" placeholder="product" required>
<input name="quantity" type="number" step="0.01" placeholder="qty (kg)" required>
<input name="unit_price" type="number" step="1" placeholder="unit price (RWF)" required>
<input name="paid" type="number" step="1" placeholder="paid (RWF)" required>
<input name="date" type="date" value="{{ now_date }}">
<input name="due_date" type="date" value="{{ due_date_default }}">
<select name="payment_status" style="width: auto;">
  <option value="pending">Pending</option>
  <option value="paid">Paid</option>
  <option value="partial">Partial</option>
</select>
<button class="add" type="submit">Add</button>
</form>
</div>

<div class="search-form">
<form method="GET">
<input name="search" placeholder="Search by customer name..." type="text">
<button class="search" type="submit">Search</button>
</form>
</div>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    {% for m in messages %}
      <div class="flash-msg">{{ m }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<table>
<thead>
<tr>
<th>Customer</th>
<th>Product</th>
<th>Qty (kg)</th>
<th>Date</th>
<th>Total (RWF)</th>
<th>Paid (RWF)</th>
<th>Loan (RWF)</th>
<th>Status</th>
<th>Actions</th>
</tr>
</thead>
<tbody>
{% for r in records %}
<tr>
<td><a href="/customer/{{ r.customer_id }}" class="customer-link">{{ r.full_name }}</a></td>
<td>{{ r.product }}</td>
<td>{{ "%.2f"|format(r.quantity) }}</td>
<td>{{ r.date or '‚Äì' }}</td>
<td>{{ r.total|rwf }}</td>
<td>{{ r.paid|rwf }}</td>
<td style="color: {% if r.loan > 0 %}#fca5a5{% else %}#86efac{% endif %};">{{ r.loan|rwf }}</td>
<td style="color: {% if r.payment_status == 'pending' %}#fca5a5{% elif r.payment_status == 'paid' %}#86efac{% else %}#facc15{% endif %};">{{ r.payment_status|upper }}</td>
<td>
<a href="/edit/{{ r.id }}"><button class="edit" style="margin: 0 3px;">Edit</button></a>
<a href="/delete/{{ r.id }}" onclick="return confirm('Delete this record?');"><button class="delete" style="margin: 0 3px;">Delete</button></a>
</td>
</tr>
{% endfor %}
</tbody>
</table>

{% if not records %}
<p style="text-align: center; margin-top: 30px; color: #94a3b8;">No records found. Add a record to get started.</p>
{% endif %}

</div>

</body>
</html>